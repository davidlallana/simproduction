{% extends '::base.html.twig' %}{% block body %}{% for key, flash in app.session.getFlashes() %}<span id="{{flash}}"></span>{% endfor %}<article class="half data-block ">	<div class="data-container with-header full-height">		<h2>Histórico de compras</h2>		<div class="clear" id="historial"></div>	</div></article><article class="half-last  data-block">	<div class="data-container with-header double-height">				<header>			<h2>Compra de {% if empresa.sector.id==1 %} herramientas{% else %} minerales{% endif %}</h2>		</header>		<div class="clear" id="boxscroll2">			<table class="normal sortable">							<tbody>						<tr>						<th>Empresa</th>						<th class="sorttable_numeric">Cantidad</th>						<th class="sorttable_numeric">Importe</th>						<th></th>					</tr>					{% for lote in lotes1 %}						{% if lote.empresa.id>0 %}							<tr class="normal" >								<td>{{ lote.empresa.nombre }}</td>								<td class="ancho100">{{ lote.cantidad }} {% if empresa.sector.id==1 %}{% if lote.cantidad==1 %}ud{% else %}uds{% endif %}{% else %}kg{% endif %}</td>								<td class="ancho135">{{ lote.precio | number_format(0, ',', '.')}} €</td>								<td class="carrito"><a href="#" onClick="confirmarCompra({{lote.id}},{{lote.cantidad}},{{lote.precio}},'{{lote.sector.producto }}');" title="Comprar lote por {{ lote.precio | number_format(0, ',', '.')}} €"><img src="{{ asset('images/carrito.png') }} " alt="" width="17px"/> Comprar</a></td>							</tr>						{% else %}								<tr class="normal" >								<td>{{ lote.empresa.nombre }}</td>								<td class="ancho100"><input type="number" class="corto3" id="cant1" min="0" value="1"></td>								<td class="ancho135">{{ lote.precio | number_format(0, ',', '.')}} €/ {% if empresa.sector.id==1 %}ud{% else %}kg{% endif %}</td>								<td class="carrito"><a href="#" onClick="confirmarCompra({{lote.id}},cant1.value,{{lote.precio}},'{{lote.sector.producto }}');" title="Hacer compra de emergencia"><img src="{{ asset('images/carrito.png') }} " alt="" width="17px"/> Comprar</a></td>							</tr>													{% endif %}												{% endfor %}											</tbody>			</table>							</div>	</div></article><article class="half-last data-block">	<div class="data-container with-header double-height">				<header>			<h2>Compra de {% if empresa.sector.id==3 %} herramientas{% else %} vehículos{% endif %}</h2>		</header>		<div class="clear" id="boxscroll22">			<table class="normal sortable">							<tbody>						<tr>						<th>Empresa</th>						<th class="sorttable_numeric">Cantidad</th>						<th class="sorttable_numeric">Importe</th>						<th></th>					</tr>					{% for lote in lotes2 %}						{% if lote.empresa.id>0 %}							<tr class="normal" >								<td>{{ lote.empresa.nombre }}</td>								<td class="ancho100">{{ lote.cantidad }} {% if lote.cantidad==1 %}ud{% else %}uds{% endif %}</td>								<td class="ancho135">{{ lote.precio | number_format(0, ',', '.') }} €</td>								<td class="carrito"><a href="#" onClick="confirmarCompra({{lote.id}},{{lote.cantidad}},{{lote.precio}},'{{lote.sector.producto }}');" title="Comprar lote por {{ lote.precio | number_format(0, ',', '.')}} €"><img src="{{ asset('images/carrito.png') }} " alt="" width="17px"/> Comprar</a></td>							</tr>						{% else %}							<tr class="normal" >								<td>{{ lote.empresa.nombre }}</td>								<td class="ancho100"><input type="number" class="corto3" id="cant2" min="0" value="1"></td>								<td class="ancho135">{{ lote.precio | number_format(0, ',', '.') }} €/ud</td>								<td class="carrito"><a href="#" onClick="confirmarCompra({{lote.id}},cant2.value,{{lote.precio}},'{{lote.sector.producto }}');" title="Hacer compra de emergencia"><img src="{{ asset('images/carrito.png') }} " alt="" width="17px"/> Comprar</a></td>							</tr>												{% endif %}					{% endfor %}											</tbody>			</table>			</div>	</div></article><div class="modal" id="modal">	<div class="heading" id="heading">		<div class="titulo" id="titulo">Confirmación de compra</div>	</div>	<div class="content content2" id="content">		<div class="pregunta" id="pregunta">¿Estás seguro que deseas comprar este lote de <br/><span id="cantidad"></span> <span id="compra"></span> por un total de <span id="dinero"></span> € ?</div>	</div>	<div class="buttons" id="buttons"/></div>{% endblock %}{% block javascripts %}{{	parent() }}	<script>	  $(document).ready(function() {		mostrarHistorial();	  		$("#boxscroll22").niceScroll({touchbehavior:true});	  		$("#boxscroll2").niceScroll({touchbehavior:true});	  	  });	</script>	<script>	function mostrarHistorial()	{		jQuery.ajax({				url: '{{ path('mostrarHistorialCompras') }} ',			dataType: 'html',			beforeSend: function(){				$("div#historial").empty();				$("div#historial").append('<img src="{{ asset('images/loading.gif') }}" class="loading" alt=""/>'); 			},			success: function(data){				$("div#historial").empty();				$("div#historial").append(data); 			}				})	}			function confirmarCompra(id,cantidad,dinero,compra)	{			if(id<0){	dinero=cantidad*dinero;}		document.getElementById("pregunta").innerHTML ='¿Estás seguro que deseas comprar este lote de '+cantidad+' '+compra+' por un total de '+dinero+' € ?';			if(id<0){					document.getElementById("buttons").innerHTML ='<button class="btn2 close" onClick="comprarLoteEmergencia(' + id +','+cantidad+');">Sí</button><button class="btn2 close">No</button>';		}else{			document.getElementById("buttons").innerHTML ='<button class="btn2 close" onClick="comprarLote(' + id +');">Sí</button><button class="btn2 close">No</button>';		}		$('#modal').reveal({ 			animation: 'fade',                  			animationspeed: 400,                  			closeonbackgroundclick: false,          			dismissmodalclass: 'close' 		});	}		function comprarLote(lote)	{		var ajaxURL = 'comprarLote/' + lote;		jQuery.ajax({				url: ajaxURL,			dataType: 'html',			success: function(data){				if(data=='OK'){						mostrarHistorial();					var $toast = toastr['success']('La compra se ha realizado correctamente.', '');				}else if(data=="ERROR!DINERO"){					var $toast = toastr['error']('No tienes dinero suficiente para realizar la compra.', '');				}else if(data=="ERROR!STOCK"){					var $toast = toastr['error']('La compra no se ha podido realizar ya que la empresa no dispone la cantidad solicitada en stock.', '');				}else if(data=="ERROR!SECTOR"){					var $toast = toastr['warning']('No está permitido hacer compras de tu mismo sector.', '');				}else {					var $toast = toastr['error']('Ha ocurrido un error al realizar la compra.', '');				}				}    		})	}			function comprarLoteEmergencia(lote,cantidad)	{		var ajaxURL = 'compraEmergencia/' + lote+'/'+cantidad;		jQuery.ajax({				url: ajaxURL,			dataType: 'html',			success: function(data){				if(data=='OK'){						mostrarHistorial();					var $toast = toastr['success']('La compra se ha realizado correctamente.', '');				}else if(data=="ERROR!DINERO"){					var $toast = toastr['error']('No tienes dinero suficiente para realizar la compra.', '');				}else if(data=="ERROR!STOCK"){					var $toast = toastr['error']('La compra no se ha podido realizar ya que la empresa no dispone la cantidad solicitada en stock.', '');				}else if(data=="ERROR!SECTOR"){					var $toast = toastr['warning']('No está permitido hacer compras de tu mismo sector.', '');				}else {					var $toast = toastr['error']('Ha ocurrido un error al realizar la compra.', '');				}			}    		})	}		</script>	{% endblock %}